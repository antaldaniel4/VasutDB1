<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Jegyek kezelése</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
<h2>Jegyek</h2>

<!-- Új jegy hozzáadása -->
<form id="addForm" class="row g-3 mb-4">
    <div class="col-md-3">
        <input type="text" class="form-control" placeholder="Típus" id="tipus" required>
    </div>
    <div class="col-md-3">
        <input type="number" class="form-control" placeholder="Ár" id="ar" required>
    </div>
    <div class="col-md-3">
        <input type="date" class="form-control" id="ervenyesseg" required>
    </div>
    <div class="col-md-3">
        <button class="btn btn-primary w-100" type="submit">Hozzáadás</button>
    </div>
</form>

<!-- Jegyek táblázat -->
<table class="table table-bordered">
    <thead class="table-light">
    <tr>
        <th>Típus</th>
        <th>Ár (Ft)</th>
        <th>Érvényesség</th>
        <th>Műveletek</th>
    </tr>
    </thead>
    <tbody id="jegyTableBody"></tbody>
</table>

<script>
    const API_URL = '/api/jegy';

    function loadJegyek() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('jegyTableBody');
                tbody.innerHTML = '';
                data.forEach(jegy => {
                    tbody.innerHTML += `
              <tr>
                <td><input value="${jegy.tipus}" class="form-control" data-id="${jegy.id}" data-field="tipus"></td>
                <td><input value="${jegy.ar}" type="number" class="form-control" data-id="${jegy.id}" data-field="ar"></td>
                <td><input value="${jegy.ervenyesseg}" type="date" class="form-control" data-id="${jegy.id}" data-field="ervenyesseg"></td>
                <td>
                  <button class="btn btn-sm btn-success" onclick="updateJegy(${jegy.id})">Mentés</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteJegy(${jegy.id})">Törlés</button>
                </td>
              </tr>`;
                });
            });
    }

    document.getElementById('addForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = {
            tipus: document.getElementById('tipus').value,
            ar: parseInt(document.getElementById('ar').value),
            ervenyesseg: document.getElementById('ervenyesseg').value
        };
        fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(() => {
            loadJegyek();
            this.reset();
        });
    });

    function updateJegy(id) {
        const inputs = document.querySelectorAll(`input[data-id="${id}"]`);
        const updated = {};
        inputs.forEach(input => {
            updated[input.dataset.field] = input.value;
        });
        fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(updated)
        }).then(loadJegyek);
    }

    function deleteJegy(id) {
        if (confirm("Biztosan törlöd a jegyet?")) {
            fetch(`${API_URL}/${id}`, { method: 'DELETE' }).then(loadJegyek);
        }
    }

    loadJegyek();
</script>
</body>
</html>
